---
// src/pages/contact.astro
import Layout from '../layouts/Layout.astro';

const url = new URL(Astro.request.url);
const success = url.searchParams.get("success");
const error = url.searchParams.get("error");

// Enhanced error messages
const errorMessages = {
  rate_limit: "Too many requests. Please wait a moment before trying again.",
  validation_failed: "Please check your input and ensure all fields are valid.",
  send_failed: "Failed to send message. Please check your connection and try again.",
  server_error: "Server error. Please try again later.",
  network_error: "Network error. Please check your connection.",
  default: "Something went wrong. Please try again."
};

const errorMessage = error ? errorMessages[error as keyof typeof errorMessages] || errorMessages.default : null;
---

<Layout title="Contact Us">
  <section class="section-bg-5" style="min-height: 100vh; padding: 120px 20px 40px; position: relative; margin: 0;" role="main">
    
    <!-- Header -->
    <div style="text-align: center; margin-bottom: 60px;">
      <h1 class="space-font cosmic-glow" style="color: #00d4ff; font-size: 48px; font-weight: 700; margin-bottom: 16px; letter-spacing: 2px;">Contact Us</h1>
      <div style="height: 3px; width: 120px; background: #00d4ff; margin: 0 auto 24px;"></div>
      <p class="alien-font" style="color: #b0c4de; font-size: 18px; max-width: 600px; margin: 0 auto;">Get expert computer repair and IT support in Harold Hill, Romford, and throughout Essex.</p>
    </div>

    <!-- Two Column Layout -->
    <div style="max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;">
      
      <!-- Left Column - Contact Form -->
      <div style="background: rgba(26, 31, 46, 0.8); border: 1px solid #00d4ff; border-radius: 16px; padding: 40px;">
        <h2 class="space-font cosmic-glow" style="color: #00d4ff; font-size: 24px; font-weight: 600; margin-bottom: 32px; display: flex; align-items: center; gap: 12px;">
          ğŸ’¬ Send Us a Message
        </h2>

        {success && (
          <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span style="font-size: 20px;">âœ…</span>
              <p style="color: #22c55e; font-weight: 600;">Message sent successfully! We'll get back to you soon.</p>
            </div>
          </div>
        )}
        
        {errorMessage && (
          <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <span style="font-size: 20px;">âš ï¸</span>
              <p style="color: #ef4444; font-weight: 600;">{errorMessage}</p>
            </div>
          </div>
        )}

        <form id="contact-form">
          <!-- Name Field -->
          <div style="margin-bottom: 24px;">
            <label class="space-font" style="color: #e2e8f0; font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Your Name *</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              placeholder="Enter your name"
              style="width: 100%; padding: 14px; background: rgba(15, 20, 25, 0.8); border: 1px solid #00d4ff; border-radius: 8px; color: #e2e8f0; font-size: 16px;"
            />
          </div>

          <!-- Email Field -->
          <div style="margin-bottom: 24px;">
            <label class="space-font" style="color: #e2e8f0; font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Email Address *</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="your.email@example.com"
              style="width: 100%; padding: 14px; background: rgba(15, 20, 25, 0.8); border: 1px solid #00d4ff; border-radius: 8px; color: #e2e8f0; font-size: 16px;"
            />
          </div>

          <!-- Phone Field -->
          <div style="margin-bottom: 24px;">
            <label class="space-font" style="color: #e2e8f0; font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Phone Number</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder="Your number"
              style="width: 100%; padding: 14px; background: rgba(15, 20, 25, 0.8); border: 1px solid #00d4ff; border-radius: 8px; color: #e2e8f0; font-size: 16px;"
            />
          </div>

          <!-- Location Field -->
          <div style="margin-bottom: 24px;">
            <label class="space-font" style="color: #e2e8f0; font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Your Location/Area</label>
            <input
              type="text"
              id="location"
              name="location"
              placeholder="e.g. Harold Hill, Romford, Hornchurch..."
              style="width: 100%; padding: 14px; background: rgba(15, 20, 25, 0.8); border: 1px solid #00d4ff; border-radius: 8px; color: #e2e8f0; font-size: 16px;"
            />
          </div>



          <!-- Message Field -->
          <div style="margin-bottom: 32px;">
            <label class="space-font" style="color: #e2e8f0; font-size: 14px; font-weight: 600; margin-bottom: 8px; display: block;">Message *</label>
            <textarea
              id="message"
              name="message"
              required
              rows="5"
              placeholder="Briefly describe your computer issue or service requirements..."
              style="width: 100%; padding: 14px; background: rgba(15, 20, 25, 0.8); border: 1px solid #00d4ff; border-radius: 8px; color: #e2e8f0; font-size: 16px; resize: vertical; font-family: inherit;"
            ></textarea>
          </div>

          <!-- Honeypot -->
          <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off" />

          <!-- Submit Button -->
          <button
            type="submit"
            id="submit-btn"
            style="width: 100%; background: linear-gradient(135deg, #6366f1, #8b5cf6); border: none; color: white; padding: 16px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;"
          >
            ğŸ“§ Send Message
          </button>
        </form>
      </div>

      <!-- Right Column - Contact Information -->
      <div style="display: flex; flex-direction: column; gap: 24px;">
        
        <!-- Get in Touch Card -->
        <div style="background: rgba(26, 31, 46, 0.8); border: 1px solid #8b5cf6; border-radius: 16px; padding: 32px;">
          <h3 class="space-font cosmic-glow" style="color: #8b5cf6; font-size: 24px; font-weight: 600; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
            ğŸ“ Get in Touch
          </h3>
          
          <!-- Call Us -->
          <div style="margin-bottom: 20px;">
            <h4 class="space-font" style="color: #e2e8f0; font-size: 16px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
              ğŸ“± Call Us
            </h4>
            <p class="alien-font" style="color: #b0c4de; margin-bottom: 8px;">ğŸ“± Mobile: 07971 331814</p>
            <p class="alien-font" style="color: #b0c4de;">â˜ï¸ Landline: 01708 347341</p>
          </div>

          <!-- Email Us -->
          <div style="margin-bottom: 20px;">
            <h4 class="space-font" style="color: #e2e8f0; font-size: 16px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
              âœ‰ï¸ Email Us
            </h4>
            <p class="alien-font" style="color: #b0c4de;">david@chilterncomputers.net</p>
          </div>

          <!-- Visit Us -->
          <div>
            <h4 class="space-font" style="color: #e2e8f0; font-size: 16px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
              ğŸ“ Visit Us
            </h4>
            <p class="alien-font" style="color: #b0c4de; line-height: 1.6;">38 Hilldene Avenue<br>Harold Hill, Romford<br>Essex, RM3 8YP</p>
            <button style="background: #8b5cf6; border: none; color: white; padding: 8px 16px; border-radius: 6px; font-size: 14px; margin-top: 12px; cursor: pointer;">
              ğŸ—ºï¸ View on Map
            </button>
          </div>
        </div>

        <!-- Operating Hours Card -->
        <div style="background: rgba(26, 31, 46, 0.8); border: 1px solid #8b5cf6; border-radius: 16px; padding: 32px;">
          <h3 class="space-font cosmic-glow" style="color: #8b5cf6; font-size: 24px; font-weight: 600; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
            ğŸ•’ Operating Hours
          </h3>
          
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <span class="space-font" style="color: #e2e8f0; font-weight: 600;">Monday - Sunday:</span>
            <span class="space-font" style="color: #00d4ff; font-weight: 600;">9:00 AM - 9:00 PM</span>
          </div>
          
          <p class="alien-font" style="color: #b0c4de; font-size: 14px;">Emergency repairs available by appointment</p>
        </div>
      </div>
    </div>

    <!-- Mobile Responsive -->
    <style>
      @media (max-width: 1024px) {
        section > div:last-child {
          grid-template-columns: 1fr !important;
          gap: 32px !important;
        }
      }
      
      @media (max-width: 768px) {
        section {
          padding: 100px 16px 32px !important;
        }
        
        section > div:first-child h1 {
          font-size: 36px !important;
        }
        
        section > div:last-child > div {
          padding: 24px !important;
        }
        
        /* Ensure form appears first on mobile */
        section > div:last-child {
          display: flex !important;
          flex-direction: column !important;
        }
        
        section > div:last-child > div:first-child {
          order: 1;
        }
        
        section > div:last-child > div:last-child {
          order: 2;
        }
      }
      
      @media (max-width: 480px) {
        section {
          padding: 80px 12px 24px !important;
        }
        
        section > div:first-child h1 {
          font-size: 28px !important;
        }
        
        section > div:last-child > div {
          padding: 20px !important;
        }
      }
    </style>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('contact-form');
      const submitBtn = document.getElementById('submit-btn');
      
      if (form && submitBtn) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(form);
          const name = formData.get('name')?.toString().trim();
          const email = formData.get('email')?.toString().trim();
          const message = formData.get('message')?.toString().trim();
          const honeypot = formData.get('website')?.toString().trim();
          
          // Check honeypot
          if (honeypot) {
            console.log('Spam detected');
            return;
          }
          
          // Validation
          if (!name || name.length < 2) {
            alert('Please enter a valid name');
            return;
          }
          
          if (!email || !isValidEmail(email)) {
            alert('Please enter a valid email address');
            return;
          }
          
          if (!message) {
            alert('Please enter a message');
            return;
          }
          
          // Loading state
          submitBtn.disabled = true;
          submitBtn.innerHTML = 'ğŸ“§ Sending...';
          
          console.log('Form data:', {
            name,
            email,
            phone: formData.get('phone'),
            location: formData.get('location'),
            message
          });
          
          alert('Form validated successfully! Email sending not yet implemented.');
          
          // Reset
          submitBtn.disabled = false;
          submitBtn.innerHTML = 'ğŸ“§ Send Message';
        });
      }
      
      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
    });
  </script>
</Layout>